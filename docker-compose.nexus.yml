version: '3.8'

# =====================================================
# DevAlix Portfolio - Docker Compose (Nexus local)
# =====================================================

networks:
  traefik-network:
    external: true
    name: traefik-network

services:
  portfolio:
    build: .
    volumes:
      - ./index.html:/usr/share/nginx/html/index.html
      - ./css:/usr/share/nginx/html/css
      - ./js:/usr/share/nginx/html/js
      - ./assets:/usr/share/nginx/html/assets
      
    container_name: nexus_portfolio
    restart: unless-stopped

    networks:
      - traefik-network

    labels:
      # Activation Traefik
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-network"

      # Router HTTP (pas de HTTPS sur Nexus)
      - "traefik.http.routers.portfolio-nexus.rule=Host(`me.nexus.local`) || PathPrefix(`/`)"
      - "traefik.http.routers.portfolio-nexus.entrypoints=web"
      - "traefik.http.routers.portfolio-nexus.service=portfolio-nexus"
      - "traefik.http.routers.portfolio-nexus.priority=1"

      # Service
      - "traefik.http.services.portfolio-nexus.loadbalancer.server.port=80"

    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
